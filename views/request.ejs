<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" type="text/css" href="request.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
      	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
        <!-- request 클릭시 dropdown 메뉴  -->
        <script>
        // function request_dropdown() {
        // 	document.getElementById("myDropdown").classList.toggle("show");
        // }
        //
        // window.onclick = function(event) {
        // 	if (!event.target.matches('.dropbtn')) {
        //   	var dropdowns = document.getElementsByClassName("dropdown-content");
        // 		var i;
        //   	for (i = 0; i < dropdowns.length; i++) {
        //     var openDropdown = dropdowns[i];
        //     if (openDropdown.classList.contains('show')) {
        //       openDropdown.classList.remove('show');
        //     }
        //   }
        //   }
        // }

        function modify_request(request_time, param) {//comand 가 delete이면 요청 취소이므로 삭제,  update이면 요청 완료로 status를 'done'으로
          var form = document.createElement('form');
          form.setAttribute('method', 'post');
          form.setAttribute('action', "/request_data");
          document.charset = "utf-8";

          var hiddenField = document.createElement('input');
          hiddenField.setAttribute('type', 'hidden');
          hiddenField.setAttribute('name', 'comand');
          hiddenField.setAttribute('value', param);
          form.appendChild(hiddenField);
          hiddenField = document.createElement('input');
          hiddenField.setAttribute('type', 'hidden');
          hiddenField.setAttribute('name', 'requst_time');
          hiddenField.setAttribute('value', request_time);
          form.appendChild(hiddenField);

          document.body.appendChild(form);
          form.submit();
        }

      </script>
      <!-- modal popup(bootstrap)-->
      <meta name="viewport" content="width=device-width, initial-scale=1">
       <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
       <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    </head>

    <body>
      <!-- realtime request -->
  	<div id="request">
  			<div class="list">
  				<% for (var i=0; i < allRequest.length; i++) { %>
					<% var r = allRequest[i]; %>
					
					<div id="requestItem">
						<p class='title'>
							<div class="request_box"><%= r.request_time %></div>
							<div id="request_type" class="request_box tag"><%= r.request_type%></div>
							<div id="request_type" class="request_box tag"><%= r.room %></div>
						</p><br>
						<p class="content">
							<div class="dropdown">
								<button class="btn btn-light dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
									<%= r.details %>
								</button>
								<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
									<a class="dropdown-item" onclick="modify_request(<%= r.request_time %>,'update')">완료</a>
									<a class="dropdown-item" onclick="modify_request(<%= r.request_time %>,'delete')">취소</a>
								</div>
							</div>
						</p>
					</div>
  					
  				<% } %>
  			</div>
  			<button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal"><strong>+</strong></button>
  </div>
  <!-- 실시간 요청사항 추가 팝업 (modal popup) : 부트스트랩 사용-->
  		<div class="modal fade" id="myModal" role="dialog">
      <div class="modal-dialog" style="top: 150px; left: -50px;">
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
  					<h4 class="modal-title">요청사항 추가</h4>
            <button type="button" class="close" data-dismiss="modal">&times;</button> <br>

          </div>
          <div class="modal-body">
  					<!-- 백부분 코드 필요 (데이터 받아서 processing_status(??)를 false로 해서 디비에 저장해 주면 될듯 )-->
					  <form action="/new_request" method="post">
						<div style="display: flex;">
							<div class="form-group">
								<label for="request_time" style="margin-right: 5px;">현재시간</label>
								<% var dt = new Date();
									var time = dt.getHours() + ":" + dt.getMinutes() + ":" + dt.getSeconds();%>
								<input name="request_time" type="text" style="width: 70px;" value= <%= time %>  disabled />
						    </div>
						    <div style="margin-top: 2px; margin-left: 100px;">
						    	<label style="margin-right: 5px; margin-top: -0.5px;">종류</label>
								<div class="radio-inline">
									<label for="sort1"><input name="sort" type="radio" name="optradio" checked id="sort1">요청사항</label>
								</div>
								<div class="radio-inline">
									<label for="sort2"><input name="sort" type="radio" name="optradio" checked id="sort2">룸서비스</label>
								</div>

						    </div>

						</div>
  						
  						<!-- 스크롤이 안됨
  						<label for="room">방 번호</label>
    					  <select class="form-control" id="room_select">
    					    <option>1</option>
      					  <option>2</option>
    					    <option>3</option>
    					    <option>4</option>
    					    <option>5</option>
  								<option>1</option>
      					  <option>2</option>
    					    <option>3</option>
    					    <option>4</option>
    					    <option>5</option>
  								<option>1</option>
      					  <option>2</option>
    					    <option>3</option>
    					    <option>4</option>
    					    <option>5</option>
    					  </select>-->
  	            <div class="form-group" style="display: flex;">
					<label for="room" style="margin-top: 5px; margin-right: 5px;">방 번호</label>
					<input name="room" type="text" class="form-control" style="width: 55px;">
  	            </div>
  	            <div class="form-group">
  	                <label for="request_details">요청사항</label>
  	                <textarea name="request_details" class="form-control" style="height: 200px;"></textarea>
  	            </div>
  	        </form>
          </div>
          <div class="modal-footer">
				<button type="submit" class="btn btn-default" data-dismiss="modal" style="background-color: powderblue; border: none; color: white;">저장</button>
          </div>
        </div>

      </div>
    </div>



    </body>
</html>
